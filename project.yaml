version: '3.0'

expectations:
  population_size: 10000

actions:

  generate_study_population:
    run: cohortextractor:latest generate_cohort --study-definition study_definition
      --output-format feather
    outputs:
      highly_sensitive:
        cohort: output/input.feather
  stage1_data_cleaning:
    run: r:latest analysis/stage1_data_cleaning.R
    needs:
    - generate_study_population
    outputs:
      highly_sensitive:
        cohort: output/input_stage1.rds
        flow_chart_csv: output/flow_chart.csv
        flow_chart_html: output/flow_chart.html
  table_1:
    run: r:latest analysis/table_1.R
    needs:
    - stage1_data_cleaning
    outputs:
      moderately_sensitive:
        Descriptive_Table_CSV: output/table_1.csv
        Descriptive_Table_HTML: output/table_1.html
  figure_1:
    run: r:latest analysis/figure_1.R
    needs:
    - stage1_data_cleaning
    outputs:
      moderately_sensitive:
        Figure_long_covid_cases: output/figure_1.svg